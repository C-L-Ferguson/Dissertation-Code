---
title: "Chapter 2: Sentencing"
output: html_notebook
---


Inputting Functions 
```{r Inputting Libraries}
library(gt)
library(rstatix)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(lubridate)
library(scales)
library(tidyverse)
library(sf)
library(haven)
library(knitr)
library(data.table)
library("writexl")
library(broom)
library(pander)
library(scales)
library(estimatr)
library(kableExtra)
library(rvest)
library(stringr)
library(webshot2)
library(stargazer)
library(mc2d)
library(WRS2)
library(ggsignif)
library(schoRsch)
library(xtable)
library(pander)
library(htest)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

Input Data for California
https://www.courts.ca.gov/38232.htm#felony-sentencing-trends

```{r}

California_County_Level_Sentences<- read.csv(
  "C:/Users/carol/Downloads/cjr-prop47-Dashboard-Data.csv",
  header = TRUE,
  check.names = TRUE
)

```


Definitions: 
Probation: allows individuals to remain in the community under county probation supervision for all or a portion of their sentence. They may serve up to one year in jail as a condition of their supervision. 
Straight and split sentences: include non-serious, non-violent, and non-sexual felony offenses. 
Straight sentence: an individual will serve their full term in county jail and then be released without supervision. 
Split sentence: an individual typically “splits” their term between jail time and community supervision. Occasionally individuals with a split sentence will serve their entire term supervised in the community with no jail time. 
Prison Sentence: the individual will be incarcerated, serving their sentence in state prison, and typically be released on parole or PRCS.
Since Realignment, individuals released from prison for non-serious, non-violent, and non-sexual offenses are typically supervised by county probation departments under Post Release Community Supervision (PRCS). Mandatory Supervision (MS) is the community supervision portion of a split sentence.
FTA Warrent = Presentence Warrants for Failure to Appear (FTAs) in Felony Cases


```{r}
California_County_Level_Sentences <- California_County_Level_Sentences %>%
  rename(
    Probation = Q4,
    Prison = Q3,
    Split_1170h = Q6,
    Straight_1170h = Q5,
    Probation_Petition = Q7,
    PRCS_Petition = Q18,
    MS_Petition = Q12,
    Parole_Petition = Q26,
    FTA_Warrent = Q2,
    Petition_for_Modification = Q1,
    FTA_Warrant = Q2,
    Petition_for_Modification = Q1)

California_County_Level_Sentences <- California_County_Level_Sentences %>%
  unite(County_and_Quarter, County, Quarter, remove=FALSE)

California_County_Level_Sentences




```
Upload CA DA data

```{r}

California_DA_election_data<- read.csv(
  "C:/Users/carol/Desktop/California_DAs_Excel.csv",
  header = TRUE,
  check.names = TRUE
)


#Merge two dataframes and add percentages of sentences

California_Merged_Data <- merge(California_County_Level_Sentences, California_DA_election_data, by="County_and_Quarter")

California_Merged_Data <- California_Merged_Data %>%
  mutate(Total_Sentences = Prison + Probation + Split_1170h + Straight_1170h)

California_Merged_Data <- California_Merged_Data %>%
  mutate(Percentage_Prison = Prison / Total_Sentences * 100,
           Percentage_Probation = Probation / Total_Sentences * 100 ,
         Percentage_Split = Split_1170h / Total_Sentences * 100,
         Percentage_Straight = Straight_1170h / Total_Sentences * 100)


write.csv(CA_Merged_Data, "C:/Users/carol/Downloads/California_Merged_Data.csv", row.names=FALSE)

CA_Merged_Data <- read.csv(
  "C:/Users/carol/Downloads/CA_Merged_Data_FEB.csv",
  header = TRUE,
  check.names = TRUE
)

CA_Merged_Data$Election_Year[is.na(CA_Merged_Data$Election_Year)] <- 0

write.csv(CA_Merged_Data, "C:/Users/carol/Downloads/CA_Merged_Data_FEBU.csv", row.names=FALSE)

```


New York Counties 

```{r}

New_York_County_Level_Sentences <- read.csv(
  "C:/Users/carol/Desktop/NY_State_County_Level_Sentencing.csv",
  header = TRUE,
  check.names = TRUE
)
```

New York DA 

```{r}

New_York_DA <- read.csv(
  "C:/Users/carol/Desktop/NY_DA_Excel.csv",
  header = TRUE,
  check.names = TRUE
)

colnames(New_York_DA)

New_York_DA <- New_York_DA %>% 
       rename("County_and_Quarter" = "ï..County_and_Quarter",
              "Decarceratory" = "Decarceratory.",
              "Party" = "Party.",
            "Did_Incumbent_Seek_Reelection" =  "Did.Incumbent.Seek.Reelection.",
           "If_Sought_Reelection_Did_Incumbent_Win" = "If.Sought.Reelection..Did.Incumbent.Win." ,
           "Contested_Primary" = "Contested.Primary." ,
           "Contested_General" = "Contested.General." ,
           "Election_Year" = "Election.Year." )




```


Merge two dataframes

```{r}

NY_Merged_Data <- merge(New_York_County_Level_Sentences, New_York_DA, by="County_and_Quarter")

NY_Merged_Data <- NY_Merged_Data %>%
  mutate(Decarceratory = Decarceratory %>%
           as.factor,
         Election_Year = Election_Year %>%
           as.factor,
         Prison = Prison %>%
           as.numeric , 
         Probation = Probation %>%
           as.numeric , 
         Total = Total %>%
           as.numeric)

NY_Merged_Data <- NY_Merged_Data %>%
  mutate(Percentage_Prison = Prison / Total * 100,
           Percentage_Jail = Jail / Total * 100 ,
         Percentage_Jail_and_Probation = Jail.and.Probation / Total * 100,
         Percentage_Probation = Probation / Total * 100,
         Percentage_Fine = Fine / Total * 100,
         Percentage_Cond_Disc = Cond.Discharge / Total * 100)



write.csv(NY_Merged_Data, "C:/Users/carol/Downloads/NY_Merged_Data.csv", row.names=FALSE)

```



Pennsylvania 2013 Getting Proper Numbers

```{r}

Pennsylvania_2013_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2013_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2013_Sentences <- Pennsylvania_2013_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%m/%d/%Y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions <- Pennsylvania_2013_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform <- Pennsylvania_2013_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 



```

Pennsylvania 2014 Numbers

```{r}

Pennsylvania_2014_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2014_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2014_Sentences <- Pennsylvania_2014_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%m/%d/%Y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2014 <- Pennsylvania_2014_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2014,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2014.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform_2014 <- Pennsylvania_2014_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 


```

Pennsylvania 2015 Numbers

```{r}

Pennsylvania_2015_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2015_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2015_Sentences <- Pennsylvania_2015_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%m/%d/%Y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2015 <- Pennsylvania_2015_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2015,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2015.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform_2015 <- Pennsylvania_2015_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 


```

Pennsylvania 2016 Numbers

```{r}

Pennsylvania_2016_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2016_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2016_Sentences <- Pennsylvania_2016_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%m/%d/%Y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2016 <- Pennsylvania_2016_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2016,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2016.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform_2016 <- Pennsylvania_2016_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 


```


```{r}

Pennsylvania_2017_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2017_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2017_Sentences <- Pennsylvania_2017_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%m/%d/%Y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2017 <- Pennsylvania_2017_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2017,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2017.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform_2017 <- Pennsylvania_2017_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 

Pennsylvania_2018_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2018_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2018_Sentences <- Pennsylvania_2018_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%m/%d/%Y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2018 <- Pennsylvania_2018_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2018,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2018.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform_2018 <- Pennsylvania_2018_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 

Pennsylvania_2019_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2019_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)

str(Pennsylvania_2019_Sentences$DOS)

#this is not working. Quarter is NA here.


Pennsylvania_2019_Sentences <- Pennsylvania_2019_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%d-%b-%y") %>%
           quarter())


#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2019 <- Pennsylvania_2019_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2019,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2019.csv", row.names=FALSE)

#conform(above, aggravated, below, mitigated, procedural, standard)

Pennsylvania_Conform_2019 <- Pennsylvania_2019_Sentences %>%
  group_by(COUNTY, quarter, CONFORM) %>%
  count() 

Pennsylvania_2020_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2020_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2020_Sentences <- Pennsylvania_2020_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%d-%b-%y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2020 <- Pennsylvania_2020_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2020,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2020.csv", row.names=FALSE)

Pennsylvania_2021_Sentences <- read.csv(
  "C:/Users/carol/Downloads/GEN_2021_NO_SID.csv",
  header = TRUE,
  check.names = TRUE
)


Pennsylvania_2021_Sentences <- Pennsylvania_2021_Sentences %>%
  mutate(quarter = DOS %>%
           as.POSIXct(format = "%d-%b-%y") %>%
          quarter()) 

#next are all within the MS_SANCTION column

#prob(5), jail(3), prison(1)

Pennsylvania_Sanctions_2021 <- Pennsylvania_2021_Sentences %>%
  group_by(COUNTY, quarter, MS_SANCTION) %>%
  count()  

write.csv(Pennsylvania_Sanctions_2021,  "C:/Users/carol/Downloads/Pennsylvania_Sanctions_2021.csv", row.names=FALSE)



```


```{r}
PA_State_County_Level_Sentencing <- read.csv(
  "C:/Users/carol/Desktop/PA_State_County_Level_Sentencing.csv",
  header = TRUE,
  check.names = TRUE
)

PA_State_County_Level_Sentencing_with_Year <- PA_State_County_Level_Sentencing %>%
  mutate(Year = case_when(str_detect(County_and_Quarter, "2013") ~ "2013", 
                         str_detect(County_and_Quarter, "2014") ~ "2014",
                         str_detect(County_and_Quarter, "2015") ~ "2015",
                         str_detect(County_and_Quarter, "2016") ~ "2016",
                         str_detect(County_and_Quarter, "2017") ~ "2017",
                         str_detect(County_and_Quarter, "2018") ~ "2018",
                         str_detect(County_and_Quarter, "2019") ~ "2019",
                         str_detect(County_and_Quarter, "2020") ~ "2020",
                         str_detect(County_and_Quarter, "2021") ~ "2021"))


write.csv(PA_State_County_Level_Sentencing_with_Year,  "C:/Users/carol/Downloads/PA_State_County_Level_Sentencing_with_Year.csv", row.names = FALSE)


```

Merging PA Info

```{r}
PA_Sentencing <- read.csv(
  "C:/Users/carol/Downloads/PA_Sentencing.csv",
  header = TRUE,
  check.names = TRUE
)

#prob(5), jail(3), prison(1)

PA_Sentencing <- PA_Sentencing %>%
  rename("County_Jail" = "X3",
         "State_Prison" = "X1",
         "Probation" = "X5",
         "Restorative_Sanction" = "X6",
         "Restrictive_intermediate_punishment" = "X4", 
         "State_intermediate_punishment" = "X2")

PA_DAs <- read.csv(
  "C:/Users/carol/Downloads/PA_DA.csv",
  header = TRUE,
  check.names = TRUE
)

PA_Merged_Data <- merge(PA_Sentencing, PA_DAs, by="County_and_Quarter")

PA_Merged_Data <- PA_Merged_Data %>%
  mutate(Decarceratory = Decarceratory. %>%
           as.factor,
         Election_Year = Election.Year. %>%
           as.factor,
         State_Prison = State_Prison %>%
           as.numeric , 
         Probation = Probation %>%
           as.numeric , 
         Total = Total %>%
           as.numeric ,
         County_Jail = County_Jail %>%
           as.numeric ,
         Restrictive_intermediate_punishment = Restrictive_intermediate_punishment %>%
           as.numeric ,
         Restorative_Sanction = Restorative_Sanction %>%
           as.numeric , 
         State_intermediate_punishment = State_intermediate_punishment %>%
           as.numeric)

PA_Merged_Data <- PA_Merged_Data %>%
  mutate(Percentage_Prison = State_Prison / Total * 100,
           Percentage_Jail = County_Jail / Total * 100 ,
         Percentage_Intermediate_Punishment = State_intermediate_punishment / Total * 100,
         Percentage_Probation = Probation / Total * 100,
         Percentage_Restorative_Sanction = Restorative_Sanction / Total * 100)

colnames(PA_Merged_Data)[2]<-"County"
colnames(PA_Merged_Data)[11]<-"County" 

PA_Merged_Data <- PA_Merged_Data %>%
  mutate(Election.Year. = ifelse(is.na(Election.Year.), 0, Election.Year.))

PA_Merged_Data <- PA_Merged_Data %>% select(-Election.Year.)

PA_Merged_Data <- PA_Merged_Data %>%
  mutate(
         Election_Year = Election.Year. %>%
           as.factor)

PA_Merged_Data$Election_Year[is.na(PA_Merged_Data$Election_Year)] <- 0


write.csv(PA_Merged_Data, "C:/Users/carol/Downloads/PA_Merged_Data_FEB.csv", row.names=FALSE)

```

Load all cleaned data

```{r Loading Clean Data}

NY_Merged_Data<- read.csv(
  "C:/Users/carol/Downloads/NY_Merged_Data_FEB.csv",
  header = TRUE,
  check.names = F
)

PA_Merged_Data<- read.csv(
  "C:/Users/carol/Downloads/PA_Merged_Data_FEB.csv",
  header = TRUE,
  check.names = F
)

CA_Merged_Data <- read.csv(
  "C:/Users/carol/Downloads/CA_Merged_Data_FEB.csv",
  header = TRUE,
  check.names = F
)

```

Analyzing NY Data

```{r New York Analysis}


NY_Merged_Data <- NY_Merged_Data %>%
  mutate(Decarceratory = Decarceratory %>%
           as.factor,
         Election_Year = Election_Year %>%
           as.factor, 
         Contested_General = Contested_General %>%
           as.factor,
         Did_Incumbent_Seek_Reelection = Did_Incumbent_Seek_Reelection %>%
         as.factor,
         Contested_Primary = Contested_Primary %>%
           as.factor) 


NY_Prison_Sentences_by_Decarceratory <- lm(data = NY_Merged_Data , Percentage_Prison ~ Decarceratory)

class(NY_Prison_Sentences_by_Decarceratory)


stargazer(NY_Prison_Sentences_by_Decarceratory,  title = "P-Test Results") %>%
<<<<<<< HEAD:Ch 2 Dissertation Code.Rmd
  write_lines("C:/Users/carol/Downloads/NY_Prison_Sent_By_Dec.txt")
=======
  write_lines("NY_Prison_Sent_By_Dec.txt")
>>>>>>> 7c30173173a6a92790086d6bdc9dda89dab9869c:Ch 2 Progressive DAs.Rmd

NY_Prison_Sentences_by_Decarceratory_aov <- aov(data = NY_Merged_Data , Percentage_Prison ~ Decarceratory)


TurkeyHSD_NY_Prison_Sentences <- TukeyHSD(NY_Prison_Sentences_by_Decarceratory_aov)

TurkeyHSD_NY_Prison_Sentences


#look at the means to see the difference


summary(NY_Prison_Sentences_by_Decarceratory)

stargazer(NY_Prison_Sentences_by_Decarceratory)

#ggplot it

ggplot(data = NY_Merged_Data , aes(Decarceratory, Percentage_Prison)) + 
  geom_boxplot()

NY_Box_Plot1 <- NY_Merged_Data %>%
drop_na(Decarceratory) %>%
  ggplot(aes(Decarceratory, Percentage_Prison)) +
  geom_boxplot()

ggsave(NY_Box_Plot1 , file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/NYboxplot1.png")

#wilcox test compares medians 

wilcox_test_decarceratory <- wilcox.test(NY_Merged_Data %>%
              filter(Decarceratory == 1) %>%
              select(Percentage_Prison) %>%
              na.omit %>%
              unlist, 
            NY_Merged_Data %>%
              filter(Decarceratory == 0) %>%
              select(Percentage_Prison) %>%
              na.omit %>%
              unlist)


#still comparing medians. p values on the two main effects and the chi-square is the interaction between the two. Chi-square is a test of independence. So if two things are when you reject the null hypothesis you are saying that you cannot reject the null hypothesis that they are independent. So we do not have evidence showing dependence. Except these two are the same.

med1way(data = NY_Merged_Data ,
        Percentage_Prison ~ Decarceratory)

med2way_Dec_Election_Year <- med2way(data = NY_Merged_Data ,
        Percentage_Prison ~ Decarceratory + Election_Year)

med2way_Dec_Election_Year_Primary <- med2way(data = NY_Merged_Data, Percentage_Prison ~ Decarceratory + Election_Year + Contested_Primary)



#mean comparison

AOV_Mean_Dec_Election <- aov(data = NY_Merged_Data , Percentage_Prison ~ Decarceratory * Election_Year)

summary(AOV_Mean_Dec_Election)

anova(AOV_Mean_Dec_Election)

AOV_Mean_Dec_Election_Primary <- aov(data = NY_Merged_Data , Percentage_Prison ~ Decarceratory * Election_Year * Contested_Primary)

summary(AOV_Mean_Dec_Election_Primary)

anova(AOV_Mean_Dec_Election_Primary)
#boxplot 
#http://sthda.com/english/articles/24-ggpubr-publication-ready-plots/76-add-p-values-and-significance-levels-to-ggplots/

#https://www.datanovia.com/en/lessons/kruskal-wallis-test-in-r/

#work on fixing this plot to be easier to read 



NY_Box_Plot_2 <- NY_Merged_Data %>%
  drop_na(Decarceratory) %>%
  ggplot(aes(x = Decarceratory , y = Percentage_Prison)) + 
  geom_boxplot(aes(fill = Election_Year)) + 
  facet_wrap(~ Election_Year) +
  geom_signif(comparisons = list(c("0" , "1")) , 
    map_signif_level = TRUE,
    textsize = 6,
    step_increase = .1
  ) +
  ylim(NA , 80) +
  labs(
    x = "Decarceratory",
    y = "Percentage of Guilty Verdicts Sentenced to Prison",
    title = "New York Differences in Prison Sentencing Percentage by Election Year",
    caption = "Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) 

ggsave(NY_Box_Plot_2, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/NYboxplot2.png")


s#is there a correlation between probation and prison

cor.test(data = NY_Merged_Data , 
         ~ Percentage_Prison + Percentage_Probation)

#graph above

NY_Point_Plot1 <- 
  NY_Merged_Data %>%
  ggplot(aes(color = Party , x = Percentage_Prison , y = Percentage_Probation)) + geom_point()

ggsave(NY_Point_Plot1, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/NY_Point_Plot1.png")


# create an independent and dependent variable. Think about if you want to do a regression (y-intercept) or Anova. I think for this I want to filter by decarceratory or not. 

NY_Merged_Data_Model_Jail <-  
  lm(Percentage_Jail ~ Contested_Primary, data = NY_Merged_Data) 

stargazer(NY_Merged_Data_Model_Jail,  title = "Percentage Jail by Contested Primary") %>%
  write_lines("NY_Data_Model_Jail_and_Primary.txt")

NY_Merged_Data_Model_Probation <- 
  lm(Percentage_Probation ~ Contested_Primary, data = NY_Merged_Data)

stargazer(NY_Merged_Data_Model_Probation,  title = "Probation by Contested Primary") %>%
  write_lines("NY_Data_Model_Probation.txt")

NY_Merged_Data_Model_Fine <- 
  lm(Percentage_Fine ~ Contested_Primary, data = NY_Merged_Data)

stargazer(NY_Merged_Data_Model_Fine,  title = "Fine by Contested Primary") %>%
  write_lines("NY_Data_Model_Fine.txt")

NY_Merged_Data_Model_Prison <- 
  lm(Percentage_Prison ~ Contested_Primary, data = NY_Merged_Data)

stargazer(NY_Merged_Data_Model_Prison,  title = "Prison by Contested Primary") %>%
  write_lines("NY_Data_Model_Prison.txt")

# do this separated by decarceratory and not.  I need seek reelection, then consider election year, then consider contested primary

NY_Decarceratory <- NY_Merged_Data %>%
  filter(Decarceratory == 1)

NY_Decarceratory_Model_Jail <-lm(Percentage_Jail ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_Decarceratory) 

NY_Decarceratory_Model_Probation <- 
  lm(Percentage_Probation ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_Decarceratory)

NY_Decarceratory_Model_Fine <- 
  lm(Percentage_Fine ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_Decarceratory)

NY_Decarceratory_Prison <- 
  lm(Percentage_Prison ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_Decarceratory)

NY_Decarceratory_Sentences_LMs <- list(NY_Decarceratory_Prison, NY_Decarceratory_Model_Jail, NY_Decarceratory_Model_Probation, NY_Decarceratory_Model_Fine)

NY_Decarceratory_Sentences_LMs <- list(NY_Decarceratory_Prison, NY_Decarceratory_Model_Jail, NY_Decarceratory_Model_Probation, NY_Decarceratory_Model_Fine)

stargazer(NY_Decarceratory_Sentences_LMs, title = "Sentences by Re-Election, Contested Primary and Election Year, Decarceratory DAs", align = TRUE)

#NonDecarceratory

NY_NonDecarceratory <- NY_Merged_Data %>%
  filter(Decarceratory == 0)

NY_NonDecarceratory_Model_Jail <-lm(Percentage_Jail ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_NonDecarceratory) 

NY_NonDecarceratory_Model_Probation <- 
  lm(Percentage_Probation ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_NonDecarceratory)

NY_NonDecarceratory_Model_Fine <- 
  lm(Percentage_Fine ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_NonDecarceratory)

NY_NonDecarceratory_Prison <- 
  lm(Percentage_Prison ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = NY_NonDecarceratory)

NY_NonDecarceratory_Sentences_LMs <- list(NY_NonDecarceratory_Prison, NY_NonDecarceratory_Model_Jail, NY_NonDecarceratory_Model_Probation, NY_NonDecarceratory_Model_Fine)

stargazer(NY_NonDecarceratory_Sentences_LMs, title = "New York: Sentences by Re-Election, Contested Primary and Election Year, Non-Decarceratory DAs", align = TRUE)

#slope = estimate of contested_primary

# y = 6.95  - 1.29x 

summary(NY_Merged_Data_Model_Prison)
summary(NY_Merged_Data_Model_Fine)
summary(NY_Merged_Data_Model_Probation)
summary(NY_Merged_Data_Model_Jail)



#combining tables. Recall there is no partisan primary in CA. NEED HELP WITH THIS ONE. 

NY_Merged_Data_Model_Prison <-  
  t_test(Percentage_Prison ~ Contested_Primary, data = NY_Merged_Data, paired = FALSE) %>%
  add_significance() 

NY_Merged_Data_Model_Probation <- 
  t_test(Percentage_Probation ~ Contested_Primary, data = NY_Merged_Data, paired = FALSE) %>%
  add_significance() 

NY_Merged_Data_Probation_combined_t <- 
  rbind(NY_Merged_Data_Model_Prison, NY_Merged_Data_Model_Probation) %>%
  gt() %>%
  tab_row_group(label = "Group 1", rows = 1) %>%
  tab_row_group(label = "Group 2", rows = 2)

NY_Merged_Data_Probation_combined_t %>%
  as_latex() %>%
  as.character() %>% 
  write_lines("NY_Merged_Data_Probation_Combined_T.txt")



```

Analyzing CA Data
```{r California Analysis}

CA_Merged_Data <- CA_Merged_Data %>%
  mutate(Decarceratory = Decarceratory %>%
           as.factor,
         Election_Year = Election_Year %>%
           as.factor, 
         Contested = Contested %>%
           as.factor,
         Did_Incumbent_Seek_Reelection = Did_Incumbent_Seek_Reelection %>%
         as.factor) 

CA_Prison_Sentences_by_Decarceratory <- lm(data = CA_Merged_Data , Percentage_Prison ~ Decarceratory)

stargazer(CA_Prison_Sentences_by_Decarceratory,  title = "California Prison by Decarceratory") %>%
  write_lines("CA_Prison_Sentences_by_Decarceratory.txt")


TukeyHSD(CA_Prison_Sentences_by_Decarceratory)

#the above might be interesting because it's not a partisan election? I am not totally sure if that actually tells us anything

wilcox.test(CA_Merged_Data %>%
              filter(Decarceratory == 1) %>%
              select(Percentage_Prison) %>%
              na.omit %>%
              unlist, 
            CA_Merged_Data %>%
              filter(Decarceratory == 0) %>%
              select(Percentage_Prison) %>%
              na.omit %>%
              unlist)

#still comparing medians

med1way(data = CA_Merged_Data ,
        Percentage_Prison ~ Decarceratory)

med2way(data = CA_Merged_Data ,
        Percentage_Prison ~ Decarceratory + Election_Year)

#boxplot

CA_Percentage_Prison_by_Decarceratory_BoxPlot <- CA_Merged_Data %>%
  ggplot(aes(fill = Election_Year, x = Decarceratory , y = Percentage_Prison)) + geom_boxplot() + facet_wrap(~ Election_Year) 

ggsave(CA_Percentage_Prison_by_Decarceratory_BoxPlot, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/CA_Box_Plot1.png")

CA_Box_Plot_2_CH2 <- CA_Merged_Data %>%
  drop_na(Decarceratory) %>%
  ggplot(aes(x = Decarceratory , y = Percentage_Prison)) + 
  geom_boxplot(aes(fill = Election_Year)) + 
  facet_wrap(~ Election_Year) +
  geom_signif(comparisons = list(c("0" , "1")) , 
    map_signif_level = TRUE,
    textsize = 6,
    step_increase = .1
  ) +
  ylim(NA , 120) +
  labs(
    x = "Decarceratory",
    y = "Percentage of Guilty Verdicts Sentenced to Prison",
    title = "California Differences in Prison Sentencing Percentage by Election Year",
    caption = "Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) 

ggsave(CA_Box_Plot_2_CH2, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/CAboxplot2Ch2.png")
#is there a correlation between probation and prison

Cor_test_CA_prison_to_probation <- cor.test(data = CA_Merged_Data , 
         ~ Percentage_Prison + Percentage_Probation)

stargazer(Cor_test_CA_prison_to_probation,  title = "California Prison to Probation") %>%
  write_lines("Cor_test_CA_prison_to_probation.txt")
#graph above


CA_Prison_to_Probation_BoxPlot <- CA_Merged_Data %>%
  ggplot(aes(color = Decarceratory, x = Percentage_Prison , y = Percentage_Probation)) + geom_point()

ggsave(CA_Prison_to_Probation_BoxPlot, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/CA_Box_Plot3.png")

#combining tables. Recall there is no partisan primary in CA. NEED HELP WITH THIS ONE. 

CA_Merged_Data_Model_Prison <-  
  t_test(Percentage_Prison ~ Contested, data = CA_Merged_Data, paired = FALSE) %>%
  add_significance() 

CA_Merged_Data_Model_Probation <- 
  t_test(Percentage_Probation ~ Contested, data = CA_Merged_Data, paired = FALSE) %>%
  add_significance() 

CA_Merged_Data_Probation_combined_t <- 
  rbind(CA_Merged_Data_Model_Prison, CA_Merged_Data_Model_Probation) %>%
  gt() %>%
  tab_row_group(label = "Group 1", rows = 1) %>%
  tab_row_group(label = "Group 2", rows = 2)

CA_Merged_Data_Probation_combined_t %>%
  as_latex() %>%
  as.character() %>% 
  write_lines("CA_Merged_Data_Probation_Combined_T.txt")

# create an independent and dependent variable. Think about if you want to do a regression (y-intercept) or Anova. I think for this I want to filter by decarceratory or not. 

CA_Merged_Data_Model_Prison <-  
  lm(Percentage_Prison ~ Contested, data = CA_Merged_Data) 

stargazer(CA_Merged_Data_Model_Prison,  title = "Percentage Prison by Contested General") %>%
  write_lines("CA_Merged_Data_Model_Prison.txt")

CA_Merged_Data_Model_Probation <- 
  lm(Percentage_Probation ~ Contested, data = CA_Merged_Data)

stargazer(CA_Merged_Data_Model_Probation,  title = "Probation by Contested General") %>%
  write_lines("CA_Data_Model_Probation.txt")

CA_Merged_Data_Model_Split <- 
  lm(Percentage_Split ~ Contested, data = CA_Merged_Data)

stargazer(CA_Merged_Data_Model_Split,  title = "Split by Contested General") %>%
  write_lines("CA_Data_Model_Split.txt")

CA_Merged_Data_Model_Straight <- 
  lm(Percentage_Straight ~ Contested, data = CA_Merged_Data)

stargazer(CA_Merged_Data_Model_Straight,  title = "Straight by Contested General") %>%
  write_lines("CA_Data_Model_Straight.txt")

# do this separated by decarceratory and not. REMEMBER THOUGH I NEED THE DECARCERATORY DA TO BE SEEKING REELECTION. I need seek reelection, then consider election year, then consider contested primary

CA_Decarceratory <- CA_Merged_Data %>%
  filter(Decarceratory == 1)

CA_Decarceratory_Model_Prison <-lm(Percentage_Prison ~  Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_Decarceratory) 

CA_Decarceratory_Model_Probation <- 
  lm(Percentage_Probation ~ Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_Decarceratory)

CA_Decarceratory_Model_Split <- 
  lm(Percentage_Split ~  Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_Decarceratory)

CA_Decarceratory_Straight <- 
  lm(Percentage_Straight ~  Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_Decarceratory)

CA_Decarceratory_Sentences_LMs <- list(CA_Decarceratory_Model_Prison, CA_Decarceratory_Model_Probation, CA_Decarceratory_Model_Split, CA_Decarceratory_Straight)

stargazer(CA_Decarceratory_Sentences_LMs, title = "Sentences by Re-Election, Contested General, and Election Year, Decarceratory DAs", align = TRUE)


CA_NonDecarceratory <- CA_Merged_Data %>%
  filter(Decarceratory == 0)

CA_NonDecarceratory_Model_Prison <-lm(Percentage_Prison ~  Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_NonDecarceratory) 

CA_NonDecarceratory_Model_Probation <- 
  lm(Percentage_Probation ~ Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_NonDecarceratory)

CA_NonDecarceratory_Model_Split <- 
  lm(Percentage_Split ~  Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_NonDecarceratory)

CA_NonDecarceratory_Straight <- 
  lm(Percentage_Straight ~  Did_Incumbent_Seek_Reelection + Contested + Election_Year, data = CA_NonDecarceratory)

CA_NonDecarceratory_Sentences_LMs <- list(CA_NonDecarceratory_Model_Prison, CA_NonDecarceratory_Model_Probation, CA_NonDecarceratory_Model_Split, CA_NonDecarceratory_Straight)

stargazer(CA_NonDecarceratory_Sentences_LMs, title = "Sentences by Re-Election, Contested General, and Election Year, Non-Decarceratory DAs", align = TRUE)

#slope = estimate of contested_primary

# y = 6.95  - 1.29x 

summary(CA_Merged_Data_Model_Prison)
summary(CA_Merged_Data_Model_Probation)
summary(CA_Merged_Data_Model_Split)
summary(CA_Merged_Data_Model_Straight)

#combining tables. Recall there is no partisan primary in CA. NEED HELP WITH THIS ONE. 

CA_Merged_Data_Model_Prison <-  
  t_test(Percentage_Prison ~ Contested, data = CA_Merged_Data, paired = FALSE) %>%
  add_significance() 

CA_Merged_Data_Model_Probation <- 
  t_test(Percentage_Probation ~ Contested, data = CA_Merged_Data, paired = FALSE) %>%
  add_significance() 

CA_Merged_Data_Probation_combined_t <- 
  rbind(CA_Merged_Data_Model_Prison, CA_Merged_Data_Model_Probation) %>%
  gt() %>%
  tab_row_group(label = "Group 1", rows = 1) %>%
  tab_row_group(label = "Group 2", rows = 2)

CA_Merged_Data_Probation_combined_t %>%
  as_latex() %>%
  as.character() %>% 
  write_lines("CA_Merged_Data_Probation_Combined_T.txt")

```

Analyzing PA Data
```{r Pennsylvania Analysis}
PA_Merged_Data <- PA_Merged_Data %>%
  mutate(Decarceratory = Decarceratory %>%
           as.factor,
         Election_Year = Election_Year %>%
           as.factor, 
         Contested_General = Contested_General %>%
           as.factor,
         Did_Incumbent_Seek_Reelection = Did_Incumbent_Seek_Reelection %>%
         as.factor,
         Contested_Primary = Contested_Primary %>%
           as.factor) 

PA_Prison_Sentences_by_Decarceratory <- aov(data = PA_Merged_Data , Percentage_Prison ~ Decarceratory)

summary(PA_Prison_Sentences_by_Decarceratory)


TukeyHSD(PA_Prison_Sentences_by_Decarceratory)

PA_Prison_Sentences_by_Decarceratory <- lm(data = PA_Merged_Data , Percentage_Prison ~ Decarceratory)

stargazer(PA_Prison_Sentences_by_Decarceratory,  title = "Pennsylvania Prison by Decarceratory") %>%
  write_lines("PA_Prison_Sentences_by_Decarceratory.txt")

wilcox.test(PA_Merged_Data %>%
              filter(Decarceratory == 1) %>%
              select(Percentage_Prison) %>%
              na.omit %>%
              unlist, 
            PA_Merged_Data %>%
              filter(Decarceratory == 0) %>%
              select(Percentage_Prison) %>%
              na.omit %>%
              unlist)

#still comparing medians

med1way(data = PA_Merged_Data ,
        Percentage_Prison ~ Decarceratory)

med2way(data = PA_Merged_Data ,
        Percentage_Prison ~ Decarceratory + Election_Year)

#boxplot

PA_Percentage_Prison_by_Decarceratory_BoxPlot <- PA_Merged_Data %>%
  ggplot(aes(fill = Election_Year, x = Decarceratory, y = Percentage_Prison)) + geom_boxplot() + facet_wrap(~ Election_Year) 

ggsave(PA_Percentage_Prison_by_Decarceratory_BoxPlot, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/PA_Box_Plot1.png")

#for Jonathan. This is showing up blank.It's because decarceratory is continuous here for some reason.  

PA_Box_Plot_2 <- PA_Merged_Data %>%
  drop_na(Decarceratory) %>%
  ggplot(aes(x = Decarceratory , y = Percentage_Prison)) + 
  geom_boxplot(aes(fill = Election_Year)) + 
  facet_wrap(~ Election_Year) +
  geom_signif(comparisons = list(c("0" , "1")) , 
    map_signif_level = TRUE,
    textsize = 6,
    step_increase = .1
  ) +
  ylim(NA , 80) +
  labs(
    x = "Decarceratory",
    y = "Percentage of Guilty Verdicts Sentenced to Prison",
    title = "Pennsylvania Differences in Prison Sentencing Percentage by Election Year",
    caption = "Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))  

ggsave(PA_Box_Plot_2, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/PAboxplot2.png")


PA_Merged_Data %>%
  ggplot(aes(fill = Election_Year, x = Decarceratory , y = Percentage_Prison)) + geom_boxplot() + facet_wrap(~ Election_Year) 

#is there a correlation between probation and prison

Cor_test_PA_prison_to_probation <- cor.test(data = PA_Merged_Data , 
         ~ Percentage_Prison + Percentage_Probation)

stargazer(Cor_test_PA_prison_to_probation,  title = "Pennsylvania Prison to Probation") %>%
  write_lines("Cor_test_PA_prison_to_probation.txt")

#graph above

PA_Prison_to_Probation_BoxPlot <- PA_Merged_Data %>%
  ggplot(aes(color = Decarceratory , x = Percentage_Prison , y = Percentage_Probation)) + geom_point() +
  scale_fill_discrete(guide = guide_legend(continuous = FALSE, label.continuous = F))

ggsave(PA_Prison_to_Probation_BoxPlot, file = "C:/Users/carol/Desktop/Dissertation Code/Dissertation-Code/Chapter 2 Visuals/PA_Box_Plot3.png")

#combining tables. Recall there is no partisan primary in CA. NEED HELP WITH THIS ONE. 

PA_Merged_Data_Model_Prison <-  
  t_test(Percentage_Prison ~ Contested.Primary., data = PA_Merged_Data, paired = FALSE) %>%
  add_significance() 

PA_Merged_Data_Model_Probation <- 
  t_test(Percentage_Probation ~ Contested.Primary., data = PA_Merged_Data, paired = FALSE) %>%
  add_significance() 

PA_Merged_Data_Probation_combined_t <- 
  rbind(PA_Merged_Data_Model_Prison, PA_Merged_Data_Model_Probation) %>%
  gt() %>%
  tab_row_group(label = "Group 1", rows = 1) %>%
  tab_row_group(label = "Group 2", rows = 2)

PA_Merged_Data_Probation_combined_t %>%
  as_latex() %>%
  as.character() %>% 
  write_lines("PA_Merged_Data_Probation_Combined_T.txt")

#get the significance of each factor for decarceratory and non-decarceratory 

PA_Decarceratory <- PA_Merged_Data %>%
  filter(Decarceratory == 1)

PA_Decarceratory_Model_Jail <-lm(Percentage_Jail ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_Decarceratory) 

PA_Decarceratory_Model_Probation <- 
  lm(Percentage_Probation ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_Decarceratory)

PA_Decarceratory_Model_Restorative_Sanction <- 
  lm(Percentage_Restorative_Sanction ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_Decarceratory)

PA_Decarceratory_Model_Prison <- 
  lm(Percentage_Prison ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_Decarceratory)

PA_Decarceratory_Model_Intermediate_Punishment <-   lm(Percentage_Intermediate_Punishment ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_Decarceratory)


PA_Decarceratory_Sentences_LMs <- list(PA_Decarceratory_Model_Prison, PA_Decarceratory_Model_Jail, PA_Decarceratory_Model_Probation, PA_Decarceratory_Model_Intermediate_Punishment, PA_Decarceratory_Model_Restorative_Sanction)

stargazer(PA_Decarceratory_Sentences_LMs, title = "Sentences by Re-Election, Contested Primary and Election Year, Decarceratory DAs", align = TRUE)

#NonDecarceratory

PA_NonDecarceratory <- PA_Merged_Data %>%
  filter(Decarceratory == 0)

PA_NonDecarceratory_Model_Jail <-lm(Percentage_Jail ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_NonDecarceratory) 

PA_NonDecarceratory_Model_Probation <- 
  lm(Percentage_Probation ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_NonDecarceratory)

PA_NonDecarceratory_Model_Restorative_Sanction <- 
  lm(Percentage_Restorative_Sanction ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_NonDecarceratory)

PA_NonDecarceratory_Model_Prison <- 
  lm(Percentage_Prison ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_NonDecarceratory)

PA_NonDecarceratory_Model_Intermediate_Punishment <-   lm(Percentage_Intermediate_Punishment ~ Did_Incumbent_Seek_Reelection + Contested_Primary + Election_Year, data = PA_NonDecarceratory)


PA_NonDecarceratory_Sentences_LMs <- list(PA_NonDecarceratory_Model_Prison, PA_NonDecarceratory_Model_Jail, PA_NonDecarceratory_Model_Probation, PA_NonDecarceratory_Model_Intermediate_Punishment, PA_NonDecarceratory_Model_Restorative_Sanction)

stargazer(PA_NonDecarceratory_Sentences_LMs, title = "Sentences by Re-Election, Contested Primary and Election Year, Non-Decarceratory DAs", align = TRUE)

#slope = estimate of contested_primary

# y = 6.95  - 1.29x 

summary(NY_Merged_Data_Model_Prison)
summary(NY_Merged_Data_Model_Fine)
summary(NY_Merged_Data_Model_Probation)
summary(NY_Merged_Data_Model_Jail)

```
